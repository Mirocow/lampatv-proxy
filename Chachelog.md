24.10.2025

1. Правильная обработка 404 ошибок

* Правильная обработка 404 ошибок
* Добавлена функция get_content_info() для предварительной проверки доступности видео
* Ошибки обрабатываются ДО начала потоковой передачи
* HTTPException выбрасывается до создания StreamingResponse

2. Безопасный генератор потока

* В генераторе video_stream_generator() убраны выбросы исключений
* Ошибки логируются, но не прерывают работу сервера
* Генератор просто завершается при ошибках

3. Улучшенная обработка исключений

* Добавлена отдельная обработка HTTPException в основном роуте
* Все исключения корректно перехватываются и логируются
* Убраны повторные выбросы исключений после начала ответа

4. Улучшенное логирование

* Более детальное логирование ошибок
* Логирование статусов ответов до начала потоковой передачи
* Traceback для неожиданных ошибок

5. Стабильная работа с прокси

* Исправлена работа с прокси при потоковой передаче
* Улучшена обработка таймаутов
* Теперь при получении 404 ошибки:
  * Сервер делает HEAD запрос для проверки доступности
  * Если видео недоступно (404), возвращается JSON ошибка
* Потоковая передача не начинается для недоступных видео
* Сервер не падает с исключениями

24.10.2025

1. Поддержка HTTP Range запросов

* Добавлена функция parse_range_header() для парсинга заголовка Range
* Функция stream_video_with_range() полностью переработана для поддержки частичного контента

2. Корректные HTTP статусы

* 206 Partial Content для Range запросов
* 200 OK для полного файла
* Правильные заголовки Content-Range и Content-Length

3. Определение размера контента

* Функция get_content_length() получает размер файла через HEAD запрос
* Автоматическое ограничение максимального размера диапазона

4. Оптимизация для видео

* Увеличен размер чанков до 100KB для лучшей производительности
* Увеличены таймауты для длительных видео потоков
* Добавлен максимальный размер диапазона (100MB по умолчанию)

24.10.2025

1. Исправление таймаутов httpx

* Все создания httpx.Timeout теперь с явными параметрами
* Добавлены отдельные настройки для connect, read, write, pool таймаутов

2. Упрощенный ProxyManager

* Добавлена базовая реализация менеджера прокси
* Поддержка валидации, ротации и мониторинга прокси

3. Улучшенная обработка ошибок

* Детальное логирование с traceback
* Раздельная обработка разных типов исключений

4. Стабильная потоковая передача

* Корректная обработка Range-запросов
* Оптимизированные размеры чанков
* Правильные заголовки для видео потоков

23.10.2025

* Проблема отсутствия таймаута, так как в новых версиях httpx требуется явно указывать все четыре параметра таймаута (connect, read, write, pool).

20.10.2025

1. Потоковая передача видео

* Добавлена функция stream_video_response() для эффективной потоковой передачи
* Поддержка Range-запросов для перемотки видео
* Потоковая передача чанками для экономии памяти

2. Автоматическое определение видео

* Функции is_video_content() и is_video_url() для автоматического определения видеофайлов
* Поддержка всех популярных видеоформатов и кодеков

3. Оптимизация производительности

* Настраиваемый размер чанков через STREAM_CHUNK_SIZE
* Таймауты для потоковой передачи
* Эффективное использование памяти

4. Совместимость с существующей логикой

* Сохранена поддержка всех существующих обработчиков (enc, enc1, enc2, enc3)
* Автоматическое переключение между обычными запросами и потоковой передачей

5. Дополнительные функции

* Эндпоинт /stream/check/ для проверки доступности видео
* Улучшенные заголовки CORS для видео потоков
* Детальное логирование потоковой передачи

19.10.2025

1. Потоковая передача видео

* Реализовано потоковая передача данных от удаленного сервера

18.10.2025

* Добавлена поддержка прокси в CONFIG:
  * use_proxy - флаг включения/выключения прокси
  * proxy_list - список прокси серверов
  * Функция load_proxy_list() - загружает список прокси из переменной окружения
  * Функция get_random_proxy() - возвращает случайный прокси из списка
* Изменена функция make_request() - теперь создает клиент с настройкой прокси

18.10.2025

1. Новый формат кодирования параметров:

* Параметры теперь кодируются в формате btoa("param/key1=value1/param/key2=value2/https://example.com/")
* Добавлена функция parse_encoded_data для парсинга такого формата

2. Обработка разных типов кодирования:

* enc: Первая часть URL в encoded данных, вторая часть в additional_segments
* enc1: URL до последнего слеша в encoded данных, последняя часть в additional_segments
* enc2: Полный URL в encoded данных, additional_segments игнорируются

Обновленные тесты:

* Тесты создают валидные encoded запросы в формате btoa
* Проверяют правильность парсинга параметров и URL
* Тестируют все три типа кодирования (enc, enc1, enc2)

18.10.2025

1. Разделение параметров:

* query_params - параметры из URL (GET параметры)
* post_data - данные из тела запроса (для POST, PUT, DELETE)
* encoded_params - параметры из закодированной строки

2. Правильное объединение параметров:

* В handle_encoded_request параметры из закодированной строки объединяются с query_params
* Query params имеют приоритет при совпадении ключей
* Post data передается отдельно как тело запроса

3. Логирование:

* Добавлено детальное логирование параметров и данных
* Улучшена отладочная информация

4. Тесты:

* Добавлены тесты для проверки раздельной обработки параметров
* Тесты проверяют объединение encoded params и query params
* Тесты проверяют правильную передачу post data

18.10.2025

1. Поддержка всех HTTP методов:

* Исправлен handle_encoded_request - теперь принимает и передает метод
* Исправлен handle_direct_request - теперь принимает и передает метод
* Все методы (GET, POST, PUT, DELETE, PATCH) теперь правильно обрабатываются

3. Передача данных:

* post_data теперь правильно передается через все обработчики в make_request
* Добавлена поддержка JSON данных в теле запроса

4. Улучшенные тесты:

* Добавлены тесты для POST, PUT, DELETE, PATCH методов
* Тесты проверяют передачу метода и данных через все уровни
* Тесты для закодированных запросов с разными методами

17.10.2025

1. ProxyManager класс - централизованное управление прокси:
 
* Проверка работоспособности при старте
* Статистика использования прокси
* Взвешенный случайный выбор (предпочтение надежным прокси)
* Автоматическое исключение неработающих прокси

2. Проверка прокси при старте - все прокси тестируются перед использованием
3. Повторные попытки - при неудаче автоматически пробуется другой прокси
4. Новые эндпоинты:

* /proxies - информация о состоянии прокси
* /proxies/revalidate - принудительная перепроверка всех прокси

5. Улучшенная обработка ошибок - статистика успехов/неудач для интеллектуального выбора прокси
6. Расширенные тесты - покрытие нового функционала работы с прокси

